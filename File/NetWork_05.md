# 伯阳的网络笔记（六）：TLS
> 因为疫情期间在外当志愿者，晚上回家无聊翻翻网络知识，权当记录了。
> 初始动笔：2019-02-28
> 修改时间：2019-03-20



# 前言
人们最初设计互联网的时候，很少考虑到安全。这样造成一个问题：**核心通信协议本质上是不安全的**，只能依靠所有参与方的诚信。这显然有些理想主义了。

之后，随着安全需求的增加，我们提出了安全通信的共识，一般来说，具有下列特性：
* 机密性
        仅有发送方和接收方能够理解传输数据的内容。
* 信息完整性
        传输双方自然是想通信的内容是完整的。
* 身份鉴别
        确实双方是正确的。


基本上所有的安全措施，都是为了维护以上几点而设计的。

TCP 和 IP 是互联网的建立基础，它们本身就是非常容易受到攻击的；当然，不止它们，其他协议，比如 DNS 和 BGP 也是同样容易受到攻击。


# 加密算法
为了更加浅显易懂，我们虚构三个人物，通信双方 Alice 和 Bob，以及一个想要窃听的坏人 Eve。
## 对称加密
**对称加密**，又称之为私钥加密，是一种混淆算法。加密和解密使用相同的密钥。

Alice 使用密钥给信息进行了加密，然后 Bob 在接收到信息的时候使用相同的密钥进行解密，Eve 虽然可以截获信息，但是没有密钥，无法解读。

![](https://github.com/BiBoyang/BoyangBlog/blob/master/Image/NetWork_26.png?raw=true)

比较典型的对称加密算法有 DES 和 AES 算法。

* 优点：计算量小、加密速度快、加密效率高。

* 缺点：交易双方都使用同样密钥，安全性得不到保证；每次使用对称加密算法时，都需要使用其他人不知道的惟一密钥，这会使得发收信息双方所拥有的钥匙数量呈几何级数增长，密钥管理成为负担。

## 非对称加密
**非对称加密**，又称双钥加密，加密和解密使用公钥和私钥。用公钥加密的内容必须用私钥才能解开，同样，私钥加密的内容只有公钥能解开。

Alice 将公钥发给 Bob，然后 Bob 用公钥将信息加密发给 Alice；Alice 在收到信息后，使用私钥进行解密。

![](https://github.com/BiBoyang/BoyangBlog/blob/master/Image/NetWork_27.png?raw=true)

最有名的非对称加密算法就是 [RSA 算法](https://en.wikipedia.org/wiki/RSA_(cryptosystem)).

# 数字签名
数字签名相当于现实世界中的盖章、签名的功能在计算机世界中进行实现的技术。数字签名可以识别篡改、伪装、防止抵赖。

在数字签名中，有 2 种行为：
* 生成消息签名的行为
* 验证消息签名的行为

生成消息签名的人是由消息发送者完成的，也称为“对消息签名”。生成签名就是根据消息内容计算数字签名的值。

验证数字签名的人是第三方。第三方验证消息的来源是否属于发送者。验证结果可以是成功，也可以是失败。

数字签名对签名密钥和验证密钥进行了区分，使用验证密钥是无法生成签名的。签名密钥只能由签名人持有，而验证密钥则是任何需要验证签名的人都可以持有。


# TLS

TLS 是一个密码学协议，用于保证通信双方之间的会话安全。TLS是一个非常复杂且博大的协议，对于一般开发者来说只需要理解其工作原理即可，如果对它非常感兴趣，可以查阅[RFC5246](https://tools.ietf.org/html/rfc5246)。

它的头部如图所示。
![](https://github.com/BiBoyang/BoyangBlog/blob/master/Image/NetWork_28.png?raw=true)


# TLS 握手

TLS 的握手是整个协议中最精密复杂的部分，在这个过程中，通信双方协商连接参数，并且完成身份验证。

由于使用的功能的不同，一般分为三种握手：
1. 完整的握手，对服务器进行身份验证；
2. 恢复之前的会话采用的简短握手；
3. 对客户端和服务器都进行身份验证的握手。

### 完整的握手
主要分为以下四个步骤：
1. 交换各自支持的功能，对需要的连接参数达成一致；
2. 验证出示的证书，或使用其他方式进行身份验证；
3. 对将用于保护会话的共享主密钥达成一致；
4. 验证握手消息并未被第三方团体修改。





# 资料来源

《HTTPS权威指南》

[SSL/TLS协议运行机制的概述](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)

[图解SSL/TLS协议](http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html)