# 伯阳的网络笔记（三）：HTTP/2
> 因为疫情期间在外当志愿者，晚上回家无聊翻翻网络知识，权当记录了。
> 初始动笔：2019-02-06
> 修改时间：2019-03-20

# HTTP/1.x 的问题
不得不说， HTTP/1.1 是一个伟大的协议，现在仍然有非常多的网站使用它，充分说明了它的健壮、巧妙。但是，它毕竟是一个创建于互联网时间前的协议，虽然已经很有预见性了，但是仍然有些过时了。主要有以下几个问题：
1. HTTP 只允许每个 TCP 连接有一个未完成的请求，会有**队首阻塞**的问题；
2. 对于同一个域名，浏览器最多只能同时创建 6~8 个 TCP 连接；
3. Header 有点过大了；
4. 为了尽可能减少请求数，需要做合并文件、减少图像等优化工作，但是这无疑造成了单个请求内容变大延迟变高的问题；
5. 明文传输。

所以，随着求变的声音越来越多，HTTP/2 应声而出。


# SPDY
等一下，正式讲到 HTTP/2 之前，我们需要先提一下 SPDY。

因为迟迟没有 HTTP/1.1 的优化出线，谷歌自己推出了一个新的网络协议，叫做 SPDY，它的很多设计，被采用到了 HTTP/2 当中，比如说多路复用、二进制分帧、头部压缩等等。


# HTTP/2简介

在2012年，W3C向社会征求 HTTP/2 的建议，然后决定将 SPDY 当做制定标准的基础。目标上， HTTP/2 致力于突破上一代协议众所周知的性能限制，对 HTTP/1.x 进行扩展，而非替代，核心概念不会改变。

它做了很多改变，下面细讲。


## 二进制分帧
HTTP/2 性能增强的核心，全在于新增的二进制分帧层，它定义了如何封装 HTTP 消息并在客户端与服务器之间传输。
![]()

这里的”层”，指的是位于会话层和应用层之间的一个新的机制：HTTP 的语义不受影响，不同的是传输期间对它们的编码方式改变了。HTTP/1.x 以换行符作为纯文本的分隔符，而 HTTP/2 将所有传输的信息分割为更小的消息和帧，并对他们采用了二进制格式的编码。


# 多向请求和响应
在 HTTP/1.x 中，如果客户端想要发送多个并行的请求以改进性能，那么必须使用多个 TCP 连接；每个连接每次只交付一个响应，多个响应必须要排队。更糟糕的在于，这样非常容易发生**队首堵塞**，从而造成 TCP 连接效率低下。

HTTP/2 中的二进制分帧，突破了这种限制，客户端和服务器可以把 HTTP 消息分解为互不依赖的帧，然后乱序发送，然后在另一端把他们重新组合起来。




# 流量控制

# 服务器推送

# 首部压缩




# HTTP2.0和HTTP3.0


# 资料来源
[RFC7540:Hypertext Transfer Protocol Version 2 (HTTP/2)](https://tools.ietf.org/html/rfc7540)

《Web性能指南》